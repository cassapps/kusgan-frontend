import{r as o,g as q,j as e,M as D,a as A,C as B,u as O,s as P,f as Y,e as W}from"./index-Vu1ZIVRK.js";function G({open:g,onClose:h,onSaved:f}){const[a,x]=o.useState({nickName:"",lastName:"",firstName:"",middleName:"",gender:"",birthday:"",street:"",brgy:"",municipality:"",email:"",mobile:"",validId:"",student:!1}),[N,v]=o.useState(""),[S,w]=o.useState(null),c=o.useRef(null),[k,M]=o.useState(!1),[i,C]=o.useState(!1),[I,j]=o.useState(""),[U,y]=o.useState(""),L=q(a.municipality);o.useEffect(()=>{g||(x({nickName:"",lastName:"",firstName:"",middleName:"",gender:"",birthday:"",street:"",brgy:"",municipality:"",email:"",mobile:"",validId:"",student:!1}),v(""),w(null),j(""),y(""),c.current&&(URL.revokeObjectURL(c.current),c.current=null))},[g]);const l=t=>{const{name:r,value:s}=t.target;if(r==="student-select"){x(n=>({...n,student:String(s)==="Yes"}));return}if(r==="municipality"){x(n=>({...n,municipality:s,brgy:""}));return}x(n=>({...n,[r]:s}))},R=()=>M(!0),T=t=>{var r;try{const s=t.split(","),n=((r=s[0].match(/:(.*?);/))==null?void 0:r[1])||"image/jpeg",u=atob(s[1]),p=new Uint8Array(u.length);for(let d=0;d<u.length;d++)p[d]=u.charCodeAt(d);const b=new File([p],`passport-${Date.now()}.jpg`,{type:n});c.current&&(URL.revokeObjectURL(c.current),c.current=null);const m=URL.createObjectURL(b);c.current=m,w(b),v(m)}catch{}};o.useEffect(()=>()=>{c.current&&(URL.revokeObjectURL(c.current),c.current=null)},[]);function F(t,r=new Date){const n=String(t||"").replace(/[^A-Za-z0-9]/g,"").toUpperCase().slice(0,6),u=String(r.getFullYear()%100).padStart(2,"0"),p=String(r.getMonth()+1).padStart(2,"0"),b=String(r.getDate()).padStart(2,"0");return(n+u+p+b).slice(0,12)}const E=async t=>{var r;if((r=t==null?void 0:t.preventDefault)==null||r.call(t),!i){C(!0),j("");try{const s=String(a.nickName||"").trim().toUpperCase();if(!s)throw new Error("Nick Name is required");const u=F(s,new Date).toLowerCase();let p="";if(S){const d=await O(S,u);p=typeof d=="string"?d:(d==null?void 0:d.url)||""}const b={LastName:String(a.lastName||"").trim(),FirstName:String(a.firstName||"").trim(),MiddleName:String(a.middleName||"").trim(),NickName:s,Gender:a.gender,Birthday:a.birthday||"",Street:String(a.street||"").trim(),Brgy:String(a.brgy||"").trim(),Municipality:String(a.municipality||"").trim(),Email:String(a.email||"").trim(),Mobile:String(a.mobile||"").trim(),ValidID:String(a.validId||"").trim(),Student:a.student?"Yes":"No",PhotoURL:p,MemberSince:new Date},m=await P(b);if(!(m!=null&&m.ok))throw new Error((m==null?void 0:m.error)||"Failed to save");y("Member added"),setTimeout(async()=>{try{await Y()}catch{}f==null||f(),h==null||h(),y("")},600)}catch(s){const n=(s==null?void 0:s.message)||"Failed to save";j(n);try{W.emit("modal:error",{message:n,source:"AddMemberModal",error:String(s)})}catch{}}finally{C(!1)}}};return g?e.jsx(D,{open:g,onClose:h,title:"Add Member",width:1e3,noInternalScroll:!0,children:e.jsxs("form",{onSubmit:E,style:{width:"100%",padding:0,background:"transparent",border:"none",boxShadow:"none",overflow:"visible"},children:[I&&e.jsx("div",{className:"small-error",style:{marginBottom:8},children:I}),U&&e.jsx("div",{style:{position:"fixed",top:20,right:20,background:"#16a34a",color:"#fff",padding:"8px 12px",borderRadius:10,boxShadow:"0 6px 16px rgba(0,0,0,.15)",zIndex:1e4},children:U}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{width:240,height:240,border:"1px solid var(--light-border)",borderRadius:12,background:"#fafbff",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:N?e.jsx("img",{src:N,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{color:"var(--muted)"},children:"No photo"})}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:10},children:e.jsx("button",{type:"button",className:"button",onClick:R,disabled:i,style:{flex:"1 1 auto"},children:"ðŸ“· Open Camera"})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1.2fr 1fr 160px",gap:12,alignItems:"end"},children:[e.jsxs("div",{className:"field",style:{margin:0},children:[e.jsx("label",{className:"label",children:"Nick Name *"}),e.jsx("input",{name:"nickName",value:a.nickName,onChange:l,required:!0,disabled:i})]}),e.jsxs("div",{className:"field",style:{margin:0},children:[e.jsx("label",{className:"label",children:"Valid ID *"}),e.jsx("input",{name:"validId",value:a.validId,onChange:l,required:!0,disabled:i})]}),e.jsxs("div",{className:"field",style:{margin:0},children:[e.jsx("label",{className:"label",children:"Student"}),e.jsxs("select",{name:"student-select",value:a.student?"Yes":"No",onChange:l,disabled:i,children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Last Name *"}),e.jsx("input",{name:"lastName",value:a.lastName,onChange:l,required:!0,disabled:i})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"First Name *"}),e.jsx("input",{name:"firstName",value:a.firstName,onChange:l,required:!0,disabled:i})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Middle Name"}),e.jsx("input",{name:"middleName",value:a.middleName,onChange:l,disabled:i})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Birthday *"}),e.jsx("input",{type:"date",name:"birthday",value:a.birthday,onChange:l,required:!0,disabled:i})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Gender *"}),e.jsxs("select",{name:"gender",value:a.gender,onChange:l,required:!0,disabled:i,children:[e.jsx("option",{value:""}),e.jsx("option",{children:"Male"}),e.jsx("option",{children:"Female"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Mobile *"}),e.jsx("input",{name:"mobile",value:a.mobile,onChange:l,required:!0,disabled:i})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{name:"email",type:"email",value:a.email,onChange:l,disabled:i})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 2fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Municipality / City"}),e.jsxs("select",{name:"municipality",value:a.municipality,onChange:l,disabled:i,children:[e.jsx("option",{value:""}),A.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Brgy."}),e.jsxs("select",{name:"brgy",value:a.brgy,onChange:l,disabled:i||!a.municipality,children:[e.jsx("option",{value:""}),L.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"House No. / Street Name / Sitio"}),e.jsx("input",{name:"street",value:a.street,onChange:l,disabled:i})]})]})]})]}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"back-btn",onClick:h,style:{background:"#e5e7eb",color:"#111",fontWeight:700},children:"Cancel"}),e.jsx("button",{type:"submit",className:"primary-btn",disabled:i,children:"Save"})]}),k&&e.jsx(B,{open:k,onClose:()=>M(!1),onCapture:T,aspectRatio:3/4,targetWidth:720,targetHeight:960})]})}):null}export{G as default};
