import{r as o,g as q,j as e,M as B,C as D,u as O,s as P,f as A}from"./index-DrG23kzj.js";function z({open:x,onClose:h,onSaved:f}){const[t,g]=o.useState({nickName:"",lastName:"",firstName:"",middleName:"",gender:"",birthday:"",street:"",brgy:"",municipality:"",email:"",mobile:"",validId:"",student:!1}),[v,N]=o.useState(""),[S,w]=o.useState(null),d=o.useRef(null),[k,C]=o.useState(!1),[a,I]=o.useState(!1),[M,y]=o.useState(""),[U,j]=o.useState(""),L=q(t.municipality);o.useEffect(()=>{x||(g({nickName:"",lastName:"",firstName:"",middleName:"",gender:"",birthday:"",street:"",brgy:"",municipality:"",email:"",mobile:"",validId:"",student:!1}),N(""),w(null),y(""),j(""),d.current&&(URL.revokeObjectURL(d.current),d.current=null))},[x]);const l=i=>{const{name:r,value:s}=i.target;if(r==="student-select"){g(c=>({...c,student:String(s)==="Yes"}));return}if(r==="municipality"){g(c=>({...c,municipality:s,brgy:""}));return}g(c=>({...c,[r]:s}))},R=()=>C(!0),T=i=>{var r;try{const s=i.split(","),c=((r=s[0].match(/:(.*?);/))==null?void 0:r[1])||"image/jpeg",u=atob(s[1]),p=new Uint8Array(u.length);for(let n=0;n<u.length;n++)p[n]=u.charCodeAt(n);const b=new File([p],`passport-${Date.now()}.jpg`,{type:c});d.current&&(URL.revokeObjectURL(d.current),d.current=null);const m=URL.createObjectURL(b);d.current=m,w(b),N(m)}catch{}};o.useEffect(()=>()=>{d.current&&(URL.revokeObjectURL(d.current),d.current=null)},[]);function F(i,r=new Date){const c=String(i||"").replace(/[^A-Za-z0-9]/g,"").toUpperCase().slice(0,6),u=String(r.getFullYear()%100).padStart(2,"0"),p=String(r.getMonth()+1).padStart(2,"0"),b=String(r.getDate()).padStart(2,"0");return(c+u+p+b).slice(0,12)}const E=async i=>{var r;if((r=i==null?void 0:i.preventDefault)==null||r.call(i),!a){I(!0),y("");try{const s=String(t.nickName||"").trim().toUpperCase();if(!s)throw new Error("Nick Name is required");const u=F(s,new Date).toLowerCase();let p="";if(S){const n=await O(S,u);p=typeof n=="string"?n:(n==null?void 0:n.url)||""}const b={LastName:String(t.lastName||"").trim(),FirstName:String(t.firstName||"").trim(),MiddleName:String(t.middleName||"").trim(),NickName:s,Gender:t.gender,Birthday:t.birthday||"",Street:String(t.street||"").trim(),Brgy:String(t.brgy||"").trim(),Municipality:String(t.municipality||"").trim(),Email:String(t.email||"").trim(),Mobile:String(t.mobile||"").trim(),ValidID:String(t.validId||"").trim(),Student:t.student?"Yes":"No",PhotoURL:p,MemberSince:new Date},m=await P(b);if(!(m!=null&&m.ok))throw new Error((m==null?void 0:m.error)||"Failed to save");j("Member added"),setTimeout(async()=>{try{await A()}catch{}f==null||f(),h==null||h(),j("")},600)}catch(s){y((s==null?void 0:s.message)||"Failed to save")}finally{I(!1)}}};return x?e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:e.jsxs("form",{onSubmit:E,style:{width:"min(1000px, 96vw)",maxHeight:"90vh",overflow:"auto",background:"#fff",borderRadius:14,padding:16,border:"1px solid var(--light-border)",boxShadow:"0 20px 60px rgba(0,0,0,.2)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:[e.jsx("div",{style:{fontWeight:800,fontSize:18},children:"Add Member"}),e.jsx("button",{type:"button",className:"button",onClick:h,style:{background:"#eee",color:"#333"},children:"âœ•"})]}),M&&e.jsx("div",{className:"small-error",style:{marginBottom:8},children:M}),U&&e.jsx("div",{style:{position:"fixed",top:20,right:20,background:"#16a34a",color:"#fff",padding:"8px 12px",borderRadius:10,boxShadow:"0 6px 16px rgba(0,0,0,.15)",zIndex:1e4},children:U}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"240px 1fr",gap:16},children:[e.jsxs("div",{children:[e.jsx("div",{style:{width:240,height:240,border:"1px solid var(--light-border)",borderRadius:12,background:"#fafbff",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center"},children:v?e.jsx("img",{src:v,alt:"preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{color:"var(--muted)"},children:"No photo"})}),e.jsx("div",{style:{display:"flex",gap:8,marginTop:10},children:e.jsx("button",{type:"button",className:"button",onClick:R,disabled:a,style:{flex:"1 1 auto"},children:"ðŸ“· Open Camera"})})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1.2fr 1fr 160px",gap:12,alignItems:"end"},children:[e.jsxs("div",{className:"field",style:{margin:0},children:[e.jsx("label",{className:"label",children:"Nick Name *"}),e.jsx("input",{name:"nickName",value:t.nickName,onChange:l,required:!0,disabled:a})]}),e.jsxs("div",{className:"field",style:{margin:0},children:[e.jsx("label",{className:"label",children:"Valid ID *"}),e.jsx("input",{name:"validId",value:t.validId,onChange:l,required:!0,disabled:a})]}),e.jsxs("div",{className:"field",style:{margin:0},children:[e.jsx("label",{className:"label",children:"Student"}),e.jsxs("select",{name:"student-select",value:t.student?"Yes":"No",onChange:l,disabled:a,children:[e.jsx("option",{children:"No"}),e.jsx("option",{children:"Yes"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Last Name *"}),e.jsx("input",{name:"lastName",value:t.lastName,onChange:l,required:!0,disabled:a})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"First Name *"}),e.jsx("input",{name:"firstName",value:t.firstName,onChange:l,required:!0,disabled:a})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Middle Name"}),e.jsx("input",{name:"middleName",value:t.middleName,onChange:l,disabled:a})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Birthday *"}),e.jsx("input",{type:"date",name:"birthday",value:t.birthday,onChange:l,required:!0,disabled:a})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Gender *"}),e.jsxs("select",{name:"gender",value:t.gender,onChange:l,required:!0,disabled:a,children:[e.jsx("option",{value:""}),e.jsx("option",{children:"Male"}),e.jsx("option",{children:"Female"})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Mobile *"}),e.jsx("input",{name:"mobile",value:t.mobile,onChange:l,required:!0,disabled:a})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{name:"email",type:"email",value:t.email,onChange:l,disabled:a})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 2fr",gap:12,marginTop:12},children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Municipality / City"}),e.jsxs("select",{name:"municipality",value:t.municipality,onChange:l,disabled:a,children:[e.jsx("option",{value:""}),B.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Brgy."}),e.jsxs("select",{name:"brgy",value:t.brgy,onChange:l,disabled:a||!t.municipality,children:[e.jsx("option",{value:""}),L.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"House No. / Street Name / Sitio"}),e.jsx("input",{name:"street",value:t.street,onChange:l,disabled:a})]})]})]})]}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:10,justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",className:"back-btn",onClick:h,style:{background:"#e5e7eb",color:"#111",fontWeight:700},children:"Cancel"}),e.jsx("button",{type:"submit",className:"primary-btn",disabled:a,children:"Save"})]}),k&&e.jsx(D,{open:k,onClose:()=>C(!1),onCapture:T,aspectRatio:3/4,targetWidth:720,targetHeight:960})]})}):null}export{z as default};
